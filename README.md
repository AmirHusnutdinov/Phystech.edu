# Phystech.edu

## Что нового в ветке?

### 1. Poerty

**Poetry** - система управления пакетами и самим проектом на Python. Используется для того, чтобы быстро накатывать все новые пакеты, управлять версией Python, используемой в проекте, а также версией проекта

Сайт poetry: https://python-poetry.org/

Текущий poetry проект запущен на версии python 3.10, остальной проект на 3.11, поэтому могут случатся конфликты

### 2. Новая архитектура приложения

Если взглянуть на многие github-проекты, можно заметить некоторую закономерность:
1. Название директорий с маленькой буквы
2. Сервер, документация и тесты находятся в разных директориях относительно корневого каталога
3. И т.д.

Советую просмотреть на архитектуру популярных проектов на github и почитать "Чистая архитектура" Роберта Мартина
- https://github.com/microsoft/graphrag
- https://github.com/lepture/authlib
- https://github.com/frol/flask-restplus-server-example

Менее формально - чтобы не нагружать корневую директорию, весь код для сервера был перенесёт в новую директорию `server`, а папки переименновы

### 3. Возможность добавлять новые рецепты 

Теперь на пути `/data/dish` можно добавлять новые `dish`! Также на пути `/data/products` можно добавлять продукты
Запросы должны быть `POST`, естественно
JSON для `dish` выглядит следующим обзразом:
```json
{
    "name": str,
    "owner": int,
    "calories": int,
    "proteins": int,
    "carbohydrates": int,
    "fats": int,
    "category": str,
    "products" : [
        {
            "id_product" : int,
            "weight": int
        },
        ...
    ]
}
```

JSON для `product`:
```json
{
    "name": str,
    "proteins": int,
    "carbohydrates": int,
    "fats": int,
    "calories": int
}
```

### 4. Рационы

А тут уже сложнее

У нас появилось +3 таблицы в бд

Таблица **diets** хранит все рационы. Поля: `(id, name, owner, description)`

Таблица **diet_dish_relate** хранит связь между определённым рационном и его блюдами. Поля `(diet_id, dish_id, weight, time_of_day)`. `time_of_day` подразумевает время потребления пищи (утро, день или вечер), хранится строкой, надо договорится по поводу формата

Таблица **users_diets** хранит связь между рационом и пользователем. Поля `(user_id, diet_id, date)`. `date` хранит дату, в которую должен потребить данный рацион пользователь.

#### Рацион
Добавление _рациона_ `POST` запросом на путь `/diets`. JSON зарос:
```json
{
    "name": str,
    "owner": int,
    "description": str,
    "dishes": [
        {
            "id": int,
            "weight": int,
            "time_of_day": str
        }
    ]
}
```
Объяснение полей:
1. `name` - название 
2. `owner` - id владельца
3. `description` - описание. Должно быть менее, чем 256 символов
4. `dishes` - массив блюд
5. `id` - очев
6. `weight` - очев
7. `time_of_day` - время суток: утро, день или вечер

#### Добавление рациона пользователю
`/{user_id}/diets` - путь. `PUT` запрос (поскольку это то, что можно обновлять). JSON:
```json
{
    "diet_id": int,
    "date": str
}
```
`date` должно быть в формате `Y-m-d`, хотя в бэке если что есть приведение к стандарту

Возможно стоит добавить возможность добавлять в JSON сразу несколько рационов

#### Получение рациона
`/{user_id}/diets` - путь, `GET` запрос. Возвращаются все возможные рационы. Имеется параметр `date` c форматом `Y-m-d`, с помощью которого можно вернуть рацион на определённый день. JSONа нет

#### Удаление рационов

В процессе....

## Предложения

Название Food Helper уже не актуально, может, стоит его заменить?

Необходимо добавить шифрование паролей

